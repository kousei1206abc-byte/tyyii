<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­è·é›¢ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆ1ãƒ¶æœˆï¼‰</title>
    <style>
        :root {
            --primary: #0056b3;
            --secondary: #f8f9fa;
            --accent: #28a745;
            --text: #333;
            --border: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --edit-bg: #fff3cd;
            --advice-bg: #e3f2fd;
            --advice-border: #90caf9;
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text);
            background: #fdfdfd;
            line-height: 1.6;
        }
        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
        }
        h1 {
            margin: 0;
            color: var(--primary);
        }
        .subtitle {
            color: #666;
            font-size: 0.9rem;
        }
        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        button {
            padding: 8px 16px;
            border: 1px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: var(--primary);
            color: white;
        }
        button.active {
            background: var(--primary);
            color: white;
        }
        button.danger {
            border-color: #dc3545;
            color: #dc3545;
        }
        button.danger:hover {
            background: #dc3545;
            color: white;
        }
        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: center;
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 34px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked+.slider {
            background-color: var(--accent);
        }
        input:checked+.slider:before {
            transform: translateX(26px);
        }
        /* Settings Area */
        .settings-area {
            background: var(--secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        input[type="date"],
        input[type="text"],
        textarea,
        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
        }
        /* Perspective / Advice Box */
        .advice-box {
            background: var(--advice-bg);
            border: 1px solid var(--advice-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            color: #0d47a1;
        }
        .advice-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .advice-content ul {
            margin: 0;
            padding-left: 20px;
        }
        .advice-content li {
            margin-bottom: 5px;
        }
        /* Week Tabs */
        .week-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 0;
            border-bottom: 1px solid var(--border);
        }
        .week-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            background: #eee;
        }
        .week-tab.active {
            background: white;
            border-color: var(--border);
            border-bottom-color: white;
            font-weight: bold;
            color: var(--primary);
        }
        /* Week Theme Banner */
        .week-theme-banner {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            border-radius: 0 0 4px 4px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }
        /* Grid System */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 1fr;
            }
        }
        /* Day Card */
        .day-card {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            background: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
        }
        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        .day-card.today {
            border: 2px solid var(--accent);
            background: #f0fff4;
        }
        .day-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.2);
        }
        .day-header {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }
        .day-title {
            font-size: 1rem;
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 5px;
        }
        .day-purpose {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
            margin-bottom: 5px;
        }
        .day-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-top: auto;
        }
        .tag {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            background: #eee;
            color: #555;
        }
        .tag.tag-race {
            background: #ffebee;
            color: #c62828;
        }
        .tag.tag-rest {
            background: #e8f5e9;
            color: #2e7d32;
        }
        /* Detail View */
        .detail-panel {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            background: white;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        .detail-mode-view,
        .detail-mode-edit {
            display: none;
        }
        .detail-panel.mode-view .detail-mode-view {
            display: block;
        }
        .detail-panel.mode-edit .detail-mode-edit {
            display: block;
        }
        .detail-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .detail-row {
            margin-bottom: 15px;
        }
        .detail-label {
            font-weight: bold;
            color: #555;
            display: block;
            margin-bottom: 4px;
        }
        .detail-content {
            white-space: pre-wrap;
        }
        .edit-field {
            margin-bottom: 15px;
            padding: 10px;
            background: var(--secondary);
            border-radius: 4px;
        }
        .edit-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .edit-field.highlight {
            background: var(--edit-bg);
            border: 1px solid #ffeeba;
        }
        /* Utility */
        .hidden {
            display: none !important;
        }
        .btn-save {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
        }
        .btn-save:hover {
            background: #218838;
        }
        /* Filter */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .filter-chip {
            padding: 4px 10px;
            border-radius: 15px;
            border: 1px solid #ccc;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .filter-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
        }
        .modal-footer {
            margin-top: 20px;
            text-align: right;
        }
        /* Disclaimer */
        .disclaimer-box {
            background: #fff3f3;
            border: 1px solid #ffc9c9;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-top: 30px;
        }
        .disclaimer-box ul {
            margin: 5px 0 0 20px;
            padding: 0;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .container {
                max-width: 100%;
                padding: 0;
            }
            .schedule-grid {
                grid-template-columns: repeat(7, 1fr) !important;
                gap: 5px;
            }
            .day-card {
                min-height: auto;
                border: 1px solid #000;
                page-break-inside: avoid;
            }
            body {
                font-size: 10pt;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸­è·é›¢ï¼ˆ800m-1500mï¼‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>
            <p class="subtitle">4é€±é–“å¼·åŒ–è¨ˆç”» + èª¿æ•´</p>
        </header>
        <div class="advice-box no-print">
            <div class="advice-title">ğŸ’¡ å¤§äº‹ãªè¦–ç‚¹ï¼ˆé˜²å¤§ç”Ÿãƒ»ä¸­è·é›¢å‘ã‘ï¼‰</div>
            <div class="advice-content">
                <ul>
                    <li><strong>ã€Œä»Šæ—¥ã¯ä½•ã‚’é›ãˆã‚‹æ—¥ã‹ã€åˆ†ã‹ã‚‰ãªã„ç·´ç¿’ã¯ã‚„ã‚‰ãªã„</strong>ï¼šç›®çš„ã‚’å¸¸ã«æ„è­˜ã—ã¦ãã ã•ã„ã€‚</li>
                    <li><strong>é€Ÿãèµ°ã‚‹ ï¼ è¿½ã„è¾¼ã‚€ã€ã§ã¯ãªã„</strong>ï¼šãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’å‡ºã™æ„Ÿè¦šãŒé‡è¦ã§ã™ã€‚</li>
                    <li><strong>ç–²ã‚Œã¦ã„ã‚‹æ—¥ã¯</strong> ğŸ‘‰ ç›®çš„é”æˆã§ãã¦ã„ã‚Œã°é€”ä¸­ã§åˆ‡ã‚Šä¸Šã’ã¦OKï¼ˆç„¡ç†ã‚’ã—ã¦æ€ªæˆ‘ã‚’ã™ã‚‹ã®ãŒæœ€æ‚ªã§ã™ï¼‰ã€‚</li>
                </ul>
            </div>
        </div>
        <div class="disclaimer-box no-print" style="margin-top:0; margin-bottom:20px;">
            <strong>âš ï¸ åŸºæœ¬çš„ãªæ³¨æ„ç‚¹ï¼š</strong>
            <ul>
                <li>ç—›ã¿ã‚„å¼·ã„ç–²åŠ´ã‚’æ„Ÿã˜ã‚‹å ´åˆã¯ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä¸­æ–­ã—ã¦ä¼‘æ¯ã—ã¦ãã ã•ã„ã€‚</li>
                <li>ç¡çœ ã¨é£Ÿäº‹ï¼ˆç‰¹ã«é‰„åˆ†ãƒ»ç‚­æ°´åŒ–ç‰©ï¼‰ã‚’ååˆ†ã«æ‘‚ã‚‹ã“ã¨ãŒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®åŠ¹æœã‚’é«˜ã‚ã¾ã™ã€‚</li>
                <li>è²§è¡€ã‚„é‰„æ¬ ä¹ã®å…†å€™ãŒã‚ã‚‹å ´åˆã¯ç„¡ç†ã‚’ã›ãšã€åŒ»ç™‚æ©Ÿé–¢ã‚’å—è¨ºã—ã¦ãã ã•ã„ã€‚</li>
            </ul>
        </div>
        <!-- Controls & Settings -->
        <div class="settings-area no-print">
            <div class="form-group">
                <label>ãƒ—ãƒ©ãƒ³é–‹å§‹æ—¥:</label>
                <input type="date" id="startDateInput">
            </div>
            <div class="form-group">
                <label>ç›®æ¨™ã‚¿ã‚¤ãƒ  (1500m):</label>
                <input type="text" id="target1500Input" placeholder="ä¾‹: 3:55.0">
            </div>
            <div class="form-group">
                <label>ç›®æ¨™ã‚¿ã‚¤ãƒ  (800m):</label>
                <input type="text" id="target800Input" placeholder="ä¾‹: 1:58.0">
            </div>
            <div class="toggle-container">
                <span>é–²è¦§ãƒ¢ãƒ¼ãƒ‰</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="modeSwitch">
                    <span class="slider"></span>
                </label>
                <span>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</span>
            </div>
            <div class="controls">
                <button onclick="app.scrollToToday()">ä»Šæ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
                <button onclick="app.showPaceCalc()">ãƒšãƒ¼ã‚¹è¨ˆç®—</button>
                <button onclick="app.showExportModal()">ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãå‡ºã—/èª­ã¿è¾¼ã¿</button>
                <button class="danger" onclick="app.resetData()">åˆæœŸåŒ–</button>
            </div>
        </div>
        <!-- Filters -->
        <div class="filters no-print">
            <span style="align-self: center; font-weight: bold; margin-right: 5px;">çµã‚Šè¾¼ã¿:</span>
            <div id="filterContainer" style="display:contents;">
                <!-- Generated by JS -->
            </div>
        </div>
        <!-- Week Tabs -->
        <div class="week-tabs no-print" id="weekTabs">
            <button class="week-tab active" onclick="app.setWeek(0)">Week 1</button>
            <button class="week-tab" onclick="app.setWeek(1)">Week 2</button>
            <button class="week-tab" onclick="app.setWeek(2)">Week 3</button>
            <button class="week-tab" onclick="app.setWeek(3)">Week 4</button>
        </div>
        <!-- Week Theme Banner -->
        <div class="week-theme-banner" id="weekThemeBanner">
            <!-- Theme text injected by JS -->
        </div>
        <!-- Calendar Grid -->
        <div class="schedule-grid" id="scheduleGrid">
            <!-- Generated by JS -->
        </div>
        <!-- Detail Panel -->
        <div class="detail-panel hidden" id="detailPanel">
            <div class="detail-header">
                <h2 id="detailDate"></h2>
            </div>
            <!-- View Mode Content -->
            <div class="detail-mode-view">
                <div class="detail-row">
                    <span class="detail-label">ãƒ†ãƒ¼ãƒ/ã‚¿ã‚¤ãƒˆãƒ«</span>
                    <div class="detail-content" id="viewTitle"
                        style="font-size:1.2rem; font-weight:bold; color:var(--primary);"></div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ç›®çš„</span>
                    <div class="detail-content" id="viewPurpose"></div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                    <div class="detail-content" id="viewMenu"
                        style="background:#f8f9fa; padding:10px; border-left:4px solid var(--primary);"></div>
                </div>
                <div class="detail-row" style="display:flex; gap:20px;">
                    <div>
                        <span class="detail-label">å¼·åº¦ (RPE)</span>
                        <div class="detail-content" id="viewRpe"></div>
                    </div>
                    <div>
                        <span class="detail-label">ç›®å®‰ãƒšãƒ¼ã‚¹</span>
                        <div class="detail-content" id="viewPace"></div>
                    </div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ãƒã‚¤ãƒ³ãƒˆ</span>
                    <div class="detail-content" id="viewPoints"></div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">è£œå¼·</span>
                    <div class="detail-content" id="viewStrength"></div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">æ³¨æ„ç‚¹</span>
                    <div class="detail-content" id="viewCaution" style="color:#d32f2f;"></div>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ã‚¿ã‚°</span>
                    <div class="detail-content" id="viewTags"></div>
                </div>
            </div>
            <!-- Edit Mode Content -->
            <div class="detail-mode-edit">
                <div class="edit-field highlight">
                    <label>ã‚¿ã‚¤ãƒˆãƒ« (ä¾‹: 400mã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«)</label>
                    <input type="text" id="editTitle">
                </div>
                <div class="edit-field">
                    <label>ä»Šæ—¥ã®ç›®çš„</label>
                    <input type="text" id="editPurpose">
                </div>
                <div class="edit-field highlight">
                    <label>ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´° (æ”¹è¡Œå¯)</label>
                    <textarea id="editMenu" rows="5"></textarea>
                </div>
                <div style="display:flex; gap:10px;">
                    <div class="edit-field" style="flex:1;">
                        <label>å¼·åº¦ RPE (1-10)</label>
                        <select id="editRpe">
                            <option value="1">1 (éå¸¸ã«æ¥½)</option>
                            <option value="3">3 (æ¥½)</option>
                            <option value="5">5 (æ™®é€š)</option>
                            <option value="7">7 (ã‚„ã‚„ãã¤ã„)</option>
                            <option value="9">9 (ãã¤ã„)</option>
                            <option value="10">10 (é™ç•Œ)</option>
                        </select>
                    </div>
                    <div class="edit-field" style="flex:1;">
                        <label>ç›®å®‰ãƒšãƒ¼ã‚¹</label>
                        <input type="text" id="editPace">
                    </div>
                </div>
                <div class="edit-field">
                    <label>ãƒã‚¤ãƒ³ãƒˆ (ç®‡æ¡æ›¸ãæ¨å¥¨)</label>
                    <textarea id="editPoints" rows="3"></textarea>
                </div>
                <div class="edit-field">
                    <label>è£œå¼·</label>
                    <input type="text" id="editStrength">
                </div>
                <div class="edit-field">
                    <label>æ³¨æ„ç‚¹</label>
                    <input type="text" id="editCaution">
                </div>
                <div class="edit-field">
                    <label>ã‚¿ã‚°é¸æŠ</label>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;" id="editTagsContainer">
                        <!-- Checkboxes generated by JS -->
                    </div>
                </div>
                <button class="btn-save" onclick="app.saveCurrentDay()">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>
        <footer style="margin-top: 50px; text-align: center; color: #999; font-size: 0.8rem; padding-bottom: 20px;">
            &copy; 2026 Middle Distance Training Planner
        </footer>
    </div>
    <!-- Import/Export Modal -->
    <div id="ioModal" class="modal">
        <div class="modal-content">
            <h3>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿æ›¸ã</h3>
            <p>ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§æ›¸ãå‡ºã—ãŸã‚Šã€JSONã‚’è²¼ã‚Šä»˜ã‘ã¦èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
            <textarea id="ioTextarea" rows="10" style="width:100%; font-family:monospace; font-size:12px;"></textarea>
            <div class="modal-footer">
                <button onclick="app.copyToClipboard()">ã‚³ãƒ”ãƒ¼</button>
                <button onclick="app.importFromTextarea()"
                    style="background:var(--accent); color:white; border:none;">èª­ã¿è¾¼ã‚“ã§é©ç”¨</button>
                <button onclick="document.getElementById('ioModal').classList.remove('show')" class="danger"
                    style="margin-left:auto;">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
    <!-- Pace Calculator Modal -->
    <div id="paceModal" class="modal">
        <div class="modal-content">
            <h3>ãƒšãƒ¼ã‚¹è¨ˆç®—æ©Ÿ (1500måŸºæº–)</h3>
            <p>1500mã®ç›®æ¨™ã‚¿ã‚¤ãƒ ã¾ãŸã¯ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            <div class="form-group">
                <label>1500m ã‚¿ã‚¤ãƒ  (ä¾‹: 4:30)</label>
                <input type="text" id="pbInput" placeholder="4:30"
                    style="font-size:1.2rem; width:100px; text-align:center;">
            </div>
            <button onclick="app.calculatePaces()"
                style="width:100%; margin-top:10px; background:var(--primary); color:white;">è¨ˆç®—ã™ã‚‹</button>
            <div id="paceResult" style="margin-top:20px; display:none;">
                <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
                    <thead>
                        <tr style="background:#eee; text-align:left;">
                            <th style="padding:8px; border:1px solid #ddd;">å¼·åº¦/ç¨®é¡</th>
                            <th style="padding:8px; border:1px solid #ddd;">400mæ›ç®—</th>
                            <th style="padding:8px; border:1px solid #ddd;">1000mæ›ç®—</th>
                        </tr>
                    </thead>
                    <tbody id="paceTableBody">
                        <!-- JS Generated -->
                    </tbody>
                </table>
                <p style="font-size:0.8rem; color:#666; margin-top:10px;">â€»ç›®å®‰ã§ã™ã€‚å€‹äººã®ç‰¹æ€§ã«ã‚ˆã‚Šèª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="modal-footer">
                <button onclick="document.getElementById('paceModal').classList.remove('show')">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
    <script>
        /**
         * Application Logic
         */
        const TAG_OPTIONS = ['åœŸå°', 'é–¾å€¤', 'ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…', 'ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', 'å›å¾©', '800m', '1500m', 'ãƒ‰ãƒªãƒ«', 'ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°'];
        const DAY_NAMES = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥']; // Starting Monday
        // --------- Time helpers ----------
        function parseTimeToSec(s) {
            if (!s) return null;
            const str = String(s).trim();
            if (!str) return null;
            if (str.includes(':')) {
                const [mPart, secPartRaw] = str.split(':');
                const m = Number(mPart);
                const sec = Number(secPartRaw);
                if (!Number.isFinite(m) || !Number.isFinite(sec)) return null;
                return m * 60 + sec;
            }
            const sec = Number(str);
            return Number.isFinite(sec) ? sec : null;
        }
        function formatSec(sec) {
            if (sec == null || !Number.isFinite(sec)) return '';
            const m = Math.floor(sec / 60);
            const s = sec - m * 60;
            const sInt = Math.floor(s);
            const dec = Math.round((s - sInt) * 10);
            const s2 = String(sInt).padStart(2, '0');
            return `${m}:${s2}.${dec}`;
        }
        function computeRepTime(dist, basisSec, basisDist, adjPer400Min, adjPer400Max) {
            if (!basisSec) return null;
            const base = basisSec * (dist / basisDist);
            const scale = dist / 400;
            const aMin = (adjPer400Min ?? 0) * scale;
            const aMax = (adjPer400Max ?? adjPer400Min ?? 0) * scale;
            const tMin = base + Math.min(aMin, aMax);
            const tMax = base + Math.max(aMin, aMax);
            if (Math.abs(tMax - tMin) < 0.15) return { single: tMin };
            return { range: [tMin, tMax] };
        }
        function distLabel(m) {
            if (m >= 1000) return `${m / 1000}km`;
            return `${m}m`;
        }
        const WEEK_THEMES = [
            "åŸºæœ¬ã®åœŸå°ä½œã‚Šãƒ»å›å¾©",
            "ã‚­ãƒ„ã•ã«æ…£ã‚Œã‚‹ï¼ˆãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã¸ã®é©å¿œï¼‰",
            "ãƒ¬ãƒ¼ã‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ¬ç•ªã‚’æƒ³å®šã—ã¦ä»•ä¸Šã’ã‚‹ï¼‰",
            "ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°ï¼ˆç–²åŠ´ã‚’æŠœã„ã¦ã‚­ãƒ¬ã ã‘æ®‹ã™ï¼‰"
        ];
        const DEFAULT_PLAN = [
            // Week 1 (Day1-7)
            {
                dayId: 0,
                title: 'Jog 8ã€œ10km + æµã—',
                purpose: 'æœ‰é…¸ç´ ã®åœŸå°ã¥ãã‚Šï¼‹ç¥çµŒç³»ã‚’ç›®è¦šã‚ã•ã›ã‚‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ä½œã‚Šï¼‰',
                menu: 'Upï¼šå‹•çš„ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹ãƒ‰ãƒªãƒ«\nJogï¼š8ã€œ10kmï¼ˆEï¼‰\næµã—ï¼š100mÃ—4ï¼ˆãƒªãƒ©ãƒƒã‚¯ã‚¹ï¼‰\nDownï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»å‘¼å¸ã‚’ä¹±ã•ãšä¸€å®šã§\nãƒ»æµã—ã¯è„±åŠ›ï¼ˆåŠ›ã¾ãªã„ï¼‰',
                rpe: 4,
                pace: 'Eï¼ˆæ¥½ã«ä¼šè©±ã§ãã‚‹ï¼‰',
                paceCalc: [],
                strength: 'è‚¡é–¢ç¯€/ä½“å¹¹ 10åˆ†',
                caution: 'ç–²åŠ´ãŒå¼·ã‘ã‚Œã°è·é›¢ã‚’çŸ­ç¸®',
                tags: ['åœŸå°', 'å›å¾©', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 1,
                title: '1000mÃ—4ï¼ˆR=2â€™30ï¼‰',
                purpose: '1500mã«å¿…è¦ãªã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…ã®åœŸå°ï¼ˆå¿ƒè‚ºï¼‹è„šï¼‰',
                menu: 'Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—100mÃ—3\næœ¬ç·´ç¿’ï¼š1000mÃ—4ï¼ˆR=2â€™30ï¼‰\nDownï¼šJog 2km',
                points: 'ãƒ»æƒãˆã‚‹ã®ãŒæœ€å„ªå…ˆ\nãƒ»ãƒ©ã‚¹ãƒˆ200ã§ãƒ•ã‚©ãƒ¼ãƒ ç¶­æŒ',
                rpe: 8,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ1500RPåŸºæº–ï¼š+5ã€œ8ç§’/400ï¼‰',
                paceCalc: [{ dist: 1000, basis: '1500', adjPer400Min: 5, adjPer400Max: 8 }],
                strength: 'è‡€éƒ¨/ãƒãƒ è»½ã‚ 2set',
                caution: 'å´©ã‚Œã‚‹ãªã‚‰3æœ¬ã§çµ‚äº†OK',
                tags: ['ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…', '1500m', 'åœŸå°']
            },
            {
                dayId: 2,
                title: 'å›å¾©Jog 6ã€œ8km + è£œå¼·',
                purpose: 'å‰æ—¥ã®ç–²åŠ´å›å¾©ï¼ˆæ¬¡ã®è³ªã‚’ä¸Šã’ã‚‹ï¼‰',
                menu: 'Jogï¼š6ã€œ8kmï¼ˆEï¼‰\nã‚±ã‚¢ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒ/ãƒ•ã‚©ãƒ¼ãƒ ãƒ­ãƒ¼ãƒ©ãƒ¼\nè£œå¼·ï¼šä½“å¹¹5åˆ†',
                points: 'ãƒ»å¿ƒæ‹ã‚’ä¸Šã’ãªã„\nãƒ»æ¥åœ°ã‚’é™ã‹ã«',
                rpe: 3,
                pace: 'E',
                paceCalc: [],
                strength: 'ä½“å¹¹5åˆ†',
                caution: 'å¼µã‚ŠãŒå¼·ã‘ã‚Œã°OFFã§ã‚‚OK',
                tags: ['å›å¾©', 'åœŸå°']
            },
            {
                dayId: 3,
                title: '300mÃ—6ï¼ˆR=3â€™ï¼‰',
                purpose: '800mã®ã‚¹ãƒ”ãƒ¼ãƒ‰åˆºæ¿€ï¼ˆç¥çµŒï¼‹ãƒ•ã‚©ãƒ¼ãƒ ï¼‰',
                menu: 'Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—80mÃ—3\næœ¬ç·´ç¿’ï¼š300mÃ—6ï¼ˆR=3â€™ï¼‰\nDownï¼šJog 1ã€œ2km',
                points: 'ãƒ»1æœ¬ç›®ã‹ã‚‰å‡ºã—ã™ããªã„\nãƒ»å…¨æœ¬ã€ŒåŒã˜å‹•ãã€ã§',
                rpe: 8,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ800RPåŸºæº–ï¼šÂ±0ã€œ-2ç§’/400ï¼‰',
                paceCalc: [{ dist: 300, basis: '800', adjPer400Min: -2, adjPer400Max: 0 }],
                strength: 'è…¸è…°ç­‹/è‡€éƒ¨ 2set',
                caution: 'ãƒ•ã‚©ãƒ¼ãƒ ãŒå´©ã‚ŒãŸã‚‰æœ¬æ•°ã‚’æ¸›ã‚‰ã™',
                tags: ['800m', 'ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 4,
                title: 'Jog 6km or OFF',
                purpose: 'ç–²åŠ´ç®¡ç†ï¼ˆé€±æœ«ã®æŒä¹…ç³»ã¸ã¤ãªãï¼‰',
                menu: 'é¸æŠâ‘  Jog 6kmï¼ˆEï¼‰ï¼‹æµã—60mÃ—2\né¸æŠâ‘¡ å®Œå…¨ä¼‘é¤Šï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»æ˜æ—¥ã‚’è»½ãã™ã‚‹',
                rpe: 2,
                pace: 'E',
                paceCalc: [],
                strength: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒä¸­å¿ƒ',
                caution: 'ç¡çœ å„ªå…ˆ',
                tags: ['å›å¾©']
            },
            {
                dayId: 5,
                title: '12kmãƒ“ãƒ«ãƒ‰ã‚¢ãƒƒãƒ—',
                purpose: 'æœ‰é…¸ç´ å¼·åŒ–ï¼‹å¾ŒåŠä¸Šã’ã‚‹æ„Ÿè¦šï¼ˆãƒ¬ãƒ¼ã‚¹å¾ŒåŠã®ç²˜ã‚Šï¼‰',
                menu: 'Upï¼š1ã€œ2km\n12kmï¼šå¾ŒåŠ3kmã‚’Mã€œTï¼ˆãã¤ã™ããªã„ï¼‰\nDownï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»å¾ŒåŠã§å‘¼å¸ãŒä¹±ã‚Œã™ããªã„ç¯„å›²\nãƒ»ãƒ”ãƒƒãƒç¶­æŒ',
                rpe: 7,
                pace: 'å¾ŒåŠï¼šMã€œT',
                paceCalc: [],
                strength: 'ä½“å¹¹3åˆ†ï¼‹è‡€éƒ¨1set',
                caution: 'é¢¨é‚ªæ°—å‘³/è²§è¡€æ°—å‘³ãªã‚‰æ™®é€šJogã«å¤‰æ›´',
                tags: ['åœŸå°', 'é–¾å€¤', '1500m']
            },
            {
                dayId: 6,
                title: 'å®Œå…¨ä¼‘é¤Š',
                purpose: 'å®Œå…¨å›å¾©ï¼ˆæ¬¡é€±ã®ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹é€±ã¸ï¼‰',
                menu: 'å®Œå…¨ä¼‘é¤Š\næ•£æ­©20åˆ†ï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒã®ã¿ï¼ˆä»»æ„ï¼‰',
                points: 'ãƒ»ä¼‘ã‚€ã®ã‚‚ç·´ç¿’',
                rpe: 1,
                pace: '-',
                paceCalc: [],
                strength: 'ãªã—',
                caution: 'é•å’Œæ„ŸãŒã‚ã‚‹éƒ¨ä½ã¯ã‚±ã‚¢',
                tags: ['å›å¾©']
            },
            // Week 2 (Day8-14)
            {
                dayId: 7,
                title: 'Jog 8km + æµã—',
                purpose: 'æœ‰é…¸ç´ ç¶­æŒã¨èª¿æ•´ï¼ˆç¿Œæ—¥ã®ãƒã‚¤ãƒ³ãƒˆã«å‚™ãˆã‚‹ï¼‰',
                menu: 'Upï¼šå‹•çš„ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹æµã—60mÃ—2\nJogï¼š8kmï¼ˆEã€œMæ‰‹å‰ï¼‰\næµã—ï¼š100mÃ—4\nDownï¼šè£œå¼·10åˆ†',
                points: 'ãƒ»æµã—ã¯è»½ãé€Ÿã\nãƒ»ç–²åŠ´ã‚’æ®‹ã•ãªã„',
                rpe: 4,
                pace: 'Eã€œMæ‰‹å‰',
                paceCalc: [],
                strength: 'è‚¡é–¢ç¯€ï¼ˆã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«/ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆï¼‰å„2set',
                caution: 'è„šãŒé‡ã„ãªã‚‰6kmã«çŸ­ç¸®',
                tags: ['åœŸå°', 'å›å¾©', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 8,
                title: '600+400+300 Ã—2ï¼ˆã‚»ãƒƒãƒˆï¼‰',
                purpose: 'ãƒšãƒ¼ã‚¹æ„Ÿè¦šã®å®šç€ï¼‹ä¹³é…¸è€æ€§ï¼ˆ1500å¾ŒåŠã€œ800å‰åŠã«æ…£ã‚Œã‚‹ï¼‰',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—80mÃ—3
æœ¬ç·´ç¿’ï¼šã€”600ï¼ˆ1500RPï¼‰ï¼‹400ï¼ˆä¸­é–“ï¼‰ï¼‹300ï¼ˆ800RPï¼‰ã€•Ã—2
ãƒ¬ã‚¹ãƒˆï¼šå„90ç§’ / ã‚»ãƒƒãƒˆé–“4åˆ†
Downï¼šJog 2km`,
                points: 'ãƒ»600ã¯çªã£è¾¼ã¿ã™ããªã„\nãƒ»å¾ŒåŠã»ã©ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¸å¯§ã«',
                rpe: 8,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ600=1500RP / 400=ä¸­é–“ / 300=800RPï¼‰',
                paceCalc: [
                    { dist: 600, basis: '1500', adjPer400Min: 0, adjPer400Max: 0 },
                    { dist: 400, basis: '1500', adjPer400Min: -2, adjPer400Max: 2 }, // ä¸­é–“ã¯å¹…
                    { dist: 300, basis: '800', adjPer400Min: 0, adjPer400Max: 0 }
                ],
                strength: 'ãµãã‚‰ã¯ã/ãƒãƒ è»½ã‚ 2set',
                caution: 'å´©ã‚Œã‚‹ãªã‚‰2ã‚»ãƒƒãƒˆç›®ã¯çŸ­ç¸®OK',
                tags: ['ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', 'ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…', '1500m', '800m']
            },
            {
                dayId: 9,
                title: 'å›å¾©Jog 6ã€œ8km',
                purpose: 'å›å¾©ï¼ˆç–²åŠ´ã‚’æŠœã„ã¦æ¬¡ã®ãƒã‚¤ãƒ³ãƒˆã¸ï¼‰',
                menu: 'Jogï¼š6ã€œ8kmï¼ˆEï¼‰\nã‚±ã‚¢ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹æ¸©å†·äº¤ä»£ï¼ˆä»»æ„ï¼‰',
                points: 'ãƒ»ä¼šè©±ã§ãã‚‹å¼·åº¦',
                rpe: 3,
                pace: 'E',
                paceCalc: [],
                strength: 'ä½“å¹¹åˆè¨ˆ5åˆ†',
                caution: 'å¼µã‚ŠãŒå¼·ã„ãªã‚‰OFF',
                tags: ['å›å¾©', 'åœŸå°']
            },
            {
                dayId: 10,
                title: '200mÃ—8ï¼ˆã¤ãªãJogï¼‰',
                purpose: 'ç¥çµŒåˆºæ¿€ï¼ˆé€Ÿãå‹•ã‹ã™æ„Ÿè¦šï¼‰ï¼‹ãƒ”ãƒƒãƒç¶­æŒ',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—80mÃ—3
æœ¬ç·´ç¿’ï¼š200mÃ—8ï¼ˆ200m jogï¼‰
Downï¼šJog 1ã€œ2km`,
                points: 'ãƒ»ä½™è£•ã‚ã‚‹é€Ÿã•ã§æƒãˆã‚‹\nãƒ»è‚©ã®åŠ›ã‚’æŠœã',
                rpe: 7,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ200=800RPã€œã‚„ã‚„é€Ÿã‚ï¼‰',
                paceCalc: [{ dist: 200, basis: '800', adjPer400Min: -2, adjPer400Max: 0 }],
                strength: 'è…¸è…°ç­‹/è‡€éƒ¨ 2set',
                caution: 'å¯’ã„æ—¥ã¯Upé•·ã‚',
                tags: ['ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…', '800m', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 11,
                title: 'Jog 6km or OFF',
                purpose: 'ç–²åŠ´ç®¡ç†ï¼ˆé€±æœ«ã®1000mã¸å‚™ãˆã‚‹ï¼‰',
                menu: 'é¸æŠâ‘  Jog 6kmï¼ˆEï¼‰ï¼‹æµã—60mÃ—2\né¸æŠâ‘¡ å®Œå…¨ä¼‘é¤Šï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»è»½ã•æœ€å„ªå…ˆ',
                rpe: 2,
                pace: 'E',
                paceCalc: [],
                strength: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒä¸­å¿ƒ',
                caution: 'ç–²åŠ´ãŒå¼·ã„ãªã‚‰è¿·ã‚ãšOFF',
                tags: ['å›å¾©']
            },
            {
                dayId: 12,
                title: '1000mÃ—3ï¼ˆR=3åˆ†ï¼‰',
                purpose: '1500mãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹å®šç€ï¼ˆå¿ƒè‚ºï¼‹ãƒ¡ãƒ³ã‚¿ãƒ«ï¼‰',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—100mÃ—3
æœ¬ç·´ç¿’ï¼š1000mÃ—3ï¼ˆR=3åˆ†ï¼‰
Downï¼šJog 2km`,
                points: 'ãƒ»1æœ¬ç›®æŠ‘ãˆã¦æƒãˆã‚‹\nãƒ»ãƒ©ã‚¹ãƒˆ200ã§ãƒ•ã‚©ãƒ¼ãƒ ç¶­æŒ',
                rpe: 8,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ1000=1500RPï¼‰',
                paceCalc: [{ dist: 1000, basis: '1500', adjPer400Min: 0, adjPer400Max: 0 }],
                strength: 'è£œå¼·ã¯è»½ã‚',
                caution: 'ç–²åŠ´ãŒæ®‹ã‚‹ãªã‚‰Ã—2ã«æ¸›ã‚‰ã™',
                tags: ['ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', '1500m', 'é–¾å€¤']
            },
            {
                dayId: 13,
                title: 'å®Œå…¨ä¼‘é¤Š',
                purpose: 'å®Œå…¨å›å¾©ï¼ˆæ¬¡é€±ã®ãƒ¬ãƒ¼ã‚¹æƒ³å®šã¸ï¼‰',
                menu: 'å®Œå…¨ä¼‘é¤Š\næ•£æ­©20ã€œ30åˆ†ï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼ˆä»»æ„ï¼‰',
                points: 'ãƒ»ä¼‘é¤Šã¨è£œçµ¦ï¼ˆç‚­æ°´åŒ–ç‰©ï¼‹é‰„ï¼‰',
                rpe: 1,
                pace: '-',
                paceCalc: [],
                strength: 'ãªã—',
                caution: 'é•å’Œæ„ŸãŒã‚ã‚Œã°æ—©ã‚ã«ã‚±ã‚¢',
                tags: ['å›å¾©']
            },
            // Week 3 (Day15-21)
            {
                dayId: 14,
                title: 'Jog 7km + æµã—',
                purpose: 'èª¿æ•´ï¼ˆé€±ã®ãƒ¬ãƒ¼ã‚¹æƒ³å®šç·´ç¿’ã¸å‚™ãˆã‚‹ï¼‰',
                menu: 'Jog 7kmï¼ˆEï¼‰ï¼‹æµã—100mÃ—4\nã‚±ã‚¢ï¼šã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»è„šã‚’è»½ã',
                rpe: 4,
                pace: 'E',
                paceCalc: [],
                strength: 'è‚¡é–¢ç¯€10åˆ†',
                caution: 'ç–²åŠ´ãŒå¼·ã„ãªã‚‰5kmã«çŸ­ç¸®',
                tags: ['å›å¾©', 'åœŸå°', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 15,
                title: '1200mï¼ˆ1500æƒ³å®šï¼‰+ 300mï¼ˆ800æƒ³å®šï¼‰',
                purpose: 'ãƒ¬ãƒ¼ã‚¹å¾ŒåŠã®è‹¦ã—ã„å±€é¢ã‚’å†ç¾ï¼ˆè€æ€§ï¼‹è‡ªä¿¡ï¼‰',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—100mÃ—3
æœ¬ç·´ç¿’ï¼š1200mï¼ˆ1500æƒ³å®šï¼‰â†’R=8åˆ†â†’300mï¼ˆ800æƒ³å®šï¼‰
Downï¼šJog 2km`,
                points: 'ãƒ»1200ã¯ã€Œãƒ¬ãƒ¼ã‚¹ã®è‹¦ã—ã•ã€ã‚’ä½œã‚‹\nãƒ»300ã§ãƒ•ã‚©ãƒ¼ãƒ å´©ã•ãšæŠ¼ã™',
                rpe: 9,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ1200=1500RP / 300=800RPï¼‰',
                paceCalc: [
                    { dist: 1200, basis: '1500', adjPer400Min: 0, adjPer400Max: 0 },
                    { dist: 300, basis: '800', adjPer400Min: 0, adjPer400Max: 0 }
                ],
                strength: 'ã‚±ã‚¢å„ªå…ˆï¼ˆè£œå¼·ã¯è»½ãï¼‰',
                caution: 'è„šãŒé‡ã„ãªã‚‰1200ã‚’1000ã«çŸ­ç¸®',
                tags: ['ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', '1500m', '800m', 'ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…']
            },
            {
                dayId: 16,
                title: 'å›å¾©Jog 6km',
                purpose: 'å›å¾©ï¼ˆç–²åŠ´ã‚’æŠœã„ã¦ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’å‡ºã›ã‚‹çŠ¶æ…‹ã¸ï¼‰',
                menu: 'Jog 6kmï¼ˆEï¼‰\nã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹ãƒ•ã‚©ãƒ¼ãƒ ãƒ­ãƒ¼ãƒ©ãƒ¼',
                points: 'ãƒ»å‘¼å¸ã‚’æ•´ãˆã‚‹',
                rpe: 3,
                pace: 'E',
                paceCalc: [],
                strength: 'ä½“å¹¹3åˆ†',
                caution: 'å¼µã‚ŠãŒå¼·ã„ãªã‚‰OFF',
                tags: ['å›å¾©']
            },
            {
                dayId: 17,
                title: '400mÃ—4ï¼ˆR=4åˆ†ï¼‰',
                purpose: '800mã®1å‘¨ãƒšãƒ¼ã‚¹å®šç€ï¼‹ä¹³é…¸ä¸‹ã§ãƒ•ã‚©ãƒ¼ãƒ ç¶­æŒ',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—80mÃ—3
æœ¬ç·´ç¿’ï¼š400mÃ—4ï¼ˆR=4åˆ†ï¼‰
Downï¼šJog 2km`,
                points: 'ãƒ»å…¨æœ¬æƒãˆã‚‹\nãƒ»å¾ŒåŠã»ã©è…•æŒ¯ã‚Šä¸å¯§ã«',
                rpe: 9,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ400=800RPï¼‰',
                paceCalc: [{ dist: 400, basis: '800', adjPer400Min: 0, adjPer400Max: 0 }],
                strength: 'è£œå¼·ã¯ãªã—ã€œè»½ã‚',
                caution: '1æœ¬ã§ã‚‚å´©ã‚ŒãŸã‚‰æ¬¡ã¯ä¸­æ­¢ã—ã¦OK',
                tags: ['800m', 'ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', 'ã‚¹ãƒ”ãƒ¼ãƒ‰æŒä¹…']
            },
            {
                dayId: 18,
                title: 'Jog 5ã€œ6km',
                purpose: 'ç–²åŠ´ç®¡ç†ï¼ˆTTã¸å‘ã‘ã¦è„šã‚’è»½ãã™ã‚‹ï¼‰',
                menu: 'Jog 5ã€œ6kmï¼ˆEï¼‰ï¼‹æµã—60mÃ—2ï¼ˆä»»æ„ï¼‰',
                points: 'ãƒ»è»½ã•å„ªå…ˆ',
                rpe: 2,
                pace: 'E',
                paceCalc: [],
                strength: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒä¸­å¿ƒ',
                caution: 'çœ ã„/é‡ã„ãªã‚‰OFF',
                tags: ['å›å¾©']
            },
            {
                dayId: 19,
                title: 'TTï¼ˆ1500m or 800m ã©ã¡ã‚‰ã‹ï¼‰',
                purpose: 'ç¾çŠ¶ç¢ºèªï¼‹ãƒ¬ãƒ¼ã‚¹å‰ã®ç²¾ç¥çš„æº–å‚™',
                menu:
                    `Upï¼šJog 2kmï¼‹ãƒ‰ãƒªãƒ«ï¼‹æµã—100mÃ—4
æœ¬ç•ªï¼š800m or 1500mï¼ˆã©ã¡ã‚‰ã‹1ç¨®ç›®ï¼‰
Downï¼šJog 2km`,
                points: 'ãƒ»ä¸¡æ–¹ã‚„ã‚‰ãªã„\nãƒ»æœ¬ç•ªæƒ³å®šã®ã‚¢ãƒƒãƒ—ã§',
                rpe: 10,
                pace: 'TTï¼ˆå…¨åŠ›ã€œãƒ¬ãƒ¼ã‚¹æƒ³å®šï¼‰',
                paceCalc: [],
                strength: 'ãªã—ï¼ˆã‚±ã‚¢å„ªå…ˆï¼‰',
                caution: 'ç–²åŠ´å¼·ã„å ´åˆã¯TTã‚’ã€Œ1000m+300mã€ã«å¤‰æ›´å¯',
                tags: ['ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', '800m', '1500m']
            },
            {
                dayId: 20,
                title: 'å®Œå…¨ä¼‘é¤Š',
                purpose: 'å›å¾©ï¼ˆæ¬¡é€±ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°ã¸ï¼‰',
                menu: 'å®Œå…¨ä¼‘é¤Šï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»ç¡çœ ã¨è£œçµ¦',
                rpe: 1,
                pace: '-',
                paceCalc: [],
                strength: 'ãªã—',
                caution: 'é•å’Œæ„ŸãŒã‚ã‚Œã°æ—©ã‚ã«å‡¦ç½®',
                tags: ['å›å¾©']
            },
            // Week 4 (Day22-28) taper
            {
                dayId: 21,
                title: 'Jog 6km + æµã—',
                purpose: 'ç–²åŠ´ã‚’æºœã‚ãšã«å‹•ãã‚’æ•´ãˆã‚‹ï¼ˆãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°é–‹å§‹ï¼‰',
                menu: 'Jog 6kmï¼ˆEï¼‰ï¼‹æµã—100mÃ—3',
                points: 'ãƒ»è„šã‚’è»½ãã™ã‚‹',
                rpe: 4,
                pace: 'E',
                paceCalc: [],
                strength: 'è‚¡é–¢ç¯€5åˆ†',
                caution: 'é‡ã„ãªã‚‰5km',
                tags: ['ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°', 'å›å¾©', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 22,
                title: '300mÃ—3ï¼ˆåˆºæ¿€ï¼‰',
                purpose: 'ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿè¦šç¶­æŒï¼ˆç–²åŠ´ã¯æ®‹ã•ãªã„ï¼‰',
                menu: 'Upï¼šJog 2kmï¼‹æµã—\næœ¬ç·´ç¿’ï¼š300mÃ—3ï¼ˆãƒ¬ã‚¹ãƒˆé•·ã‚ï¼‰\nDownï¼šJog 1km',
                points: 'ãƒ»æ°—æŒã¡ã‚ˆãçµ‚ãˆã‚‹',
                rpe: 7,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ300=800RPï¼‰',
                paceCalc: [{ dist: 300, basis: '800', adjPer400Min: 0, adjPer400Max: 0 }],
                strength: 'ãªã—ã€œè»½ã‚',
                caution: 'å¼µã‚ŠãŒå‡ºãŸã‚‰å³ä¸­æ­¢',
                tags: ['ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°', '800m', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 23,
                title: 'Jog 5km',
                purpose: 'å›å¾©ï¼ˆç–²åŠ´ã‚¼ãƒ­ã«è¿‘ã¥ã‘ã‚‹ï¼‰',
                menu: 'Jog 5kmï¼ˆEï¼‰ï¼‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ',
                points: 'ãƒ»å¿ƒæ‹ã‚’ä¸Šã’ãªã„',
                rpe: 2,
                pace: 'E',
                paceCalc: [],
                strength: 'ã‚¹ãƒˆãƒ¬ãƒƒãƒä¸­å¿ƒ',
                caution: 'é•å’Œæ„Ÿã‚ã‚Œã°OFF',
                tags: ['ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°', 'å›å¾©']
            },
            {
                dayId: 24,
                title: '200mÃ—2ï¼ˆåˆºæ¿€ï¼‰',
                purpose: 'ç¥çµŒç³»ã®æœ€çµ‚èª¿æ•´ï¼ˆã‚­ãƒ¬ã ã‘æ®‹ã™ï¼‰',
                menu: 'Upï¼šJog 1.5ã€œ2kmï¼‹æµã—\næœ¬ç·´ç¿’ï¼š200mÃ—2ï¼ˆååˆ†ä¼‘ã‚€ï¼‰\nDownï¼šJog 1km',
                points: 'ãƒ»é€Ÿã•ã‚ˆã‚Šè»½ã•\nãƒ»ãƒ•ã‚©ãƒ¼ãƒ ç¢ºèª',
                rpe: 6,
                pace: 'è‡ªå‹•æ›ç®—ï¼ˆ200=800RPã€œã‚„ã‚„é€Ÿã‚ï¼‰',
                paceCalc: [{ dist: 200, basis: '800', adjPer400Min: -2, adjPer400Max: 0 }],
                strength: 'ãªã—',
                caution: 'ã‚„ã‚Šéããªã„',
                tags: ['ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°', '800m', 'ãƒ‰ãƒªãƒ«']
            },
            {
                dayId: 25,
                title: 'å®Œå…¨ä¼‘é¤Š',
                purpose: 'ç–²åŠ´ã‚¼ãƒ­åŒ–ï¼ˆæœ¬ç•ªå‰æ—¥ï¼‰',
                menu: 'å®Œå…¨ä¼‘é¤Š\nã‚¹ãƒˆãƒ¬ãƒƒãƒã®ã¿',
                points: 'ãƒ»ç¡çœ æœ€å„ªå…ˆ\nãƒ»ç‚­æ°´åŒ–ç‰©ã—ã£ã‹ã‚Š',
                rpe: 1,
                pace: '-',
                paceCalc: [],
                strength: 'ãªã—',
                caution: 'ä¸å®‰ã§ã‚‚è¿½ã„è¾¼ã¾ãªã„',
                tags: ['ãƒ†ãƒ¼ãƒ‘ãƒªãƒ³ã‚°', 'å›å¾©']
            },
            {
                dayId: 26,
                title: 'æœ¬ç•ªï¼ˆå¤§ä¼šï¼‰',
                purpose: 'ã“ã‚Œã¾ã§ã®ç·´ç¿’ã‚’å‡ºã—åˆ‡ã‚‹',
                menu: 'ã‚¢ãƒƒãƒ—ã¯TTã®æ—¥ã¨åŒã˜æµã‚Œ\nãƒ¬ãƒ¼ã‚¹æœ¬ç•ª',
                points: 'ãƒ»å‰åŠæŠ‘ãˆã¦å¾ŒåŠå‹è² ï¼ˆç‰¹ã«1500ï¼‰',
                rpe: 10,
                pace: 'æœ¬ç•ª',
                paceCalc: [],
                strength: 'ãªã—',
                caution: 'ä½“èª¿æ‚ªã„ãªã‚‰ã‚³ãƒ¼ãƒ/åŒ»ç™‚åˆ¤æ–­',
                tags: ['ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹', '800m', '1500m']
            },
            {
                dayId: 27,
                title: 'å›å¾©ï¼ˆJog or OFFï¼‰',
                purpose: 'å›å¾©ãƒ»æ•…éšœäºˆé˜²ï¼ˆæ¬¡ã«ã¤ãªã’ã‚‹ï¼‰',
                menu: 'é¸æŠâ‘  Jog 20ã€œ30åˆ†ï¼ˆEï¼‰\né¸æŠâ‘¡ å®Œå…¨ä¼‘é¤Š',
                points: 'ãƒ»ç—›ã¿ãƒã‚§ãƒƒã‚¯',
                rpe: 2,
                pace: 'E',
            }
        ];
        class App {
            constructor() {
                this.data = {
                    startDate: new Date().toISOString().split('T')[0],
                    targets: { t1500: '', t800: '' },
                    plan: JSON.parse(JSON.stringify(DEFAULT_PLAN))
                };
                this.state = {
                    currentWeek: 0,
                    selectedDayId: null,
                    isEditMode: false,
                    filters: []
                };
                this.el = {
                    grid: document.getElementById('scheduleGrid'),
                    detail: document.getElementById('detailPanel'),
                    tabs: document.getElementById('weekTabs'),
                    startDate: document.getElementById('startDateInput'),
                    modeSwitch: document.getElementById('modeSwitch'),
                    filterContainer: document.getElementById('filterContainer'),
                    modal: document.getElementById('ioModal'),
                    ioText: document.getElementById('ioTextarea'),
                    t1500: document.getElementById('target1500Input'),
                    t800: document.getElementById('target800Input')
                };
                this.init();
            }
            init() {
                this.loadFromStorage();
                this.renderFilters();
                this.renderTagsInputs();
                this.setWeek(0);
                // Inputs
                this.el.startDate.value = this.data.startDate;
                if (this.el.t1500) this.el.t1500.value = this.data.targets?.t1500 || '';
                if (this.el.t800) this.el.t800.value = this.data.targets?.t800 || '';
                this.el.startDate.addEventListener('change', (e) => {
                    this.data.startDate = e.target.value;
                    this.saveToStorage();
                    this.renderGrid();
                    if (this.state.selectedDayId !== null) this.renderDetail(this.state.selectedDayId);
                });
                this.el.modeSwitch.addEventListener('change', (e) => {
                    this.state.isEditMode = e.target.checked;
                    this.el.detail.classList.remove('mode-view', 'mode-edit');
                    this.el.detail.classList.add(this.state.isEditMode ? 'mode-edit' : 'mode-view');
                    if (this.state.selectedDayId !== null) this.loadEditForm(this.state.selectedDayId);
                });
                if (this.el.t1500) {
                    this.el.t1500.addEventListener('change', (e) => {
                        this.data.targets.t1500 = e.target.value.trim();
                        this.saveToStorage();
                        if (this.state.selectedDayId !== null) this.renderDetail(this.state.selectedDayId);
                        this.renderGrid();
                    });
                }
                if (this.el.t800) {
                    this.el.t800.addEventListener('change', (e) => {
                        this.data.targets.t800 = e.target.value.trim();
                        this.saveToStorage();
                        if (this.state.selectedDayId !== null) this.renderDetail(this.state.selectedDayId);
                        this.renderGrid();
                    });
                }
            }
            loadFromStorage() {
                const saved = localStorage.getItem('md_training_app_v2');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        this.data = parsed;
                        if (!this.data.plan || this.data.plan.length !== 28) {
                            this.data.plan = JSON.parse(JSON.stringify(DEFAULT_PLAN));
                        }
                        if (!this.data.targets) this.data.targets = { t1500: '', t800: '' };
                    } catch (e) {
                        console.error('Failed to load data', e);
                    }
                } else {
                    // migrate from v1 if exists
                    const old = localStorage.getItem('md_training_app_v1');
                    if (old) {
                        try {
                            const parsed = JSON.parse(old);
                            // keep startDate, but overwrite plan with full plan
                            this.data.startDate = parsed.startDate || this.data.startDate;
                            this.data.plan = JSON.parse(JSON.stringify(DEFAULT_PLAN));
                        } catch { }
                    }
                }
            }
            saveToStorage() {
                localStorage.setItem('md_training_app_v2', JSON.stringify(this.data));
            }
            resetData() {
                if (!confirm('å…¨ã¦ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
                this.data.plan = JSON.parse(JSON.stringify(DEFAULT_PLAN));
                this.data.startDate = new Date().toISOString().split('T')[0];
                this.data.targets = { t1500: '', t800: '' };
                this.el.startDate.value = this.data.startDate;
                if (this.el.t1500) this.el.t1500.value = '';
                if (this.el.t800) this.el.t800.value = '';
                this.saveToStorage();
                this.renderGrid();
                this.el.detail.classList.add('hidden');
                this.state.selectedDayId = null;
            }
            // --------- Pace rendering ----------
            getBasisSecs() {
                const t1500 = parseTimeToSec(this.data.targets?.t1500);
                const t800 = parseTimeToSec(this.data.targets?.t800);
                return { t1500, t800 };
            }
            buildAutoPaceText(dayData) {
                const { t1500, t800 } = this.getBasisSecs();
                const lines = [];
                if (!dayData.paceCalc || dayData.paceCalc.length === 0) return '';
                for (const entry of dayData.paceCalc) {
                    const basis = entry.basis;
                    const basisSec = basis === '1500' ? t1500 : t800;
                    const basisDist = basis === '1500' ? 1500 : 800;
                    if (!basisSec) {
                        lines.push(`${distLabel(entry.dist)}ï¼šç›®æ¨™ã‚¿ã‚¤ãƒ æœªå…¥åŠ›ï¼ˆ${basis}mï¼‰`);
                        continue;
                    }
                    const res = computeRepTime(entry.dist, basisSec, basisDist, entry.adjPer400Min, entry.adjPer400Max);
                    if (!res) continue;
                    if (res.single != null) {
                        lines.push(`${distLabel(entry.dist)}ï¼š${formatSec(res.single)}`);
                    } else if (res.range) {
                        lines.push(`${distLabel(entry.dist)}ï¼š${formatSec(res.range[0])} ã€œ ${formatSec(res.range[1])}`);
                    }
                }
                return lines.join('\n');
            }
            // --------- Rendering ----------
            setWeek(weekIndex) {
                this.state.currentWeek = weekIndex;
                const tabs = this.el.tabs.querySelectorAll('.week-tab');
                tabs.forEach((t, i) => t.classList.toggle('active', i === weekIndex));
                this.renderGrid();
            }
            renderGrid() {
                this.el.grid.innerHTML = '';
                const startDayIndex = this.state.currentWeek * 7;
                const endDayIndex = startDayIndex + 7;
                const baseDate = new Date(this.data.startDate);
                for (let i = startDayIndex; i < endDayIndex; i++) {
                    const dayData = this.data.plan[i];
                    const currentDate = new Date(baseDate);
                    currentDate.setDate(baseDate.getDate() + i);
                    const dateStr = `${currentDate.getMonth() + 1}/${currentDate.getDate()}`;
                    const dayName = DAY_NAMES[i % 7];
                    const isToday = this.isToday(currentDate);
                    const el = document.createElement('div');
                    el.className = `day-card ${isToday ? 'today' : ''} ${this.state.selectedDayId === i ? 'selected' : ''}`;
                    if (this.state.filters.length > 0 && !dayData.tags.some(t => this.state.filters.includes(t))) {
                        el.style.opacity = '0.3';
                    }
                    el.innerHTML = `
        <div class="day-header">
          <span>Day ${i + 1} (${dayName})</span>
          <span>${dateStr}</span>
        </div>
        <div class="day-title">${dayData.title || '(æœªå®š)'}</div>
        <div class="day-purpose">${dayData.purpose || ''}</div>
        <div class="day-tags">
          ${dayData.tags.map(t => `<span class="tag ${t === 'å›å¾©' ? 'tag-rest' : ''} ${t === 'ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹' ? 'tag-race' : ''}">${t}</span>`).join('')}
        </div>
      `;
                    el.onclick = () => this.selectDay(i);
                    this.el.grid.appendChild(el);
                }
            }
            renderFilters() {
                this.el.filterContainer.innerHTML = '';
                TAG_OPTIONS.forEach(tag => {
                    const span = document.createElement('span');
                    span.className = 'filter-chip';
                    span.textContent = tag;
                    span.onclick = () => {
                        span.classList.toggle('active');
                        if (span.classList.contains('active')) this.state.filters.push(tag);
                        else this.state.filters = this.state.filters.filter(t => t !== tag);
                        this.renderGrid();
                    };
                    this.el.filterContainer.appendChild(span);
                });
            }
            renderTagsInputs() {
                const container = document.getElementById('editTagsContainer');
                container.innerHTML = '';
                TAG_OPTIONS.forEach(tag => {
                    const label = document.createElement('label');
                    label.style.display = 'flex';
                    label.style.alignItems = 'center';
                    label.style.gap = '4px';
                    label.style.marginRight = '10px';
                    label.style.fontWeight = 'normal';
                    label.style.cursor = 'pointer';
                    label.innerHTML = `<input type="checkbox" name="editTags" value="${tag}">${tag}`;
                    container.appendChild(label);
                });
            }
            isToday(dateObj) {
                const now = new Date();
                return dateObj.getDate() === now.getDate() &&
                    dateObj.getMonth() === now.getMonth() &&
                    dateObj.getFullYear() === now.getFullYear();
            }
            scrollToToday() {
                const start = new Date(this.data.startDate);
                const now = new Date();
                start.setHours(0, 0, 0, 0);
                now.setHours(0, 0, 0, 0);
                const diffDays = Math.floor((now - start) / (1000 * 60 * 60 * 24));
                if (diffDays >= 0 && diffDays < 28) {
                    const targetWeek = Math.floor(diffDays / 7);
                    this.setWeek(targetWeek);
                    this.selectDay(diffDays);
                    this.el.detail.scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('ä»Šæ—¥ã®æ—¥ä»˜ã¯ãƒ—ãƒ©ãƒ³æœŸé–“å¤–ã§ã™ã€‚é–‹å§‹æ—¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            }
            selectDay(dayIndex) {
                this.state.selectedDayId = dayIndex;
                const cards = this.el.grid.querySelectorAll('.day-card');
                cards.forEach((c, idx) => {
                    const gridDayStart = this.state.currentWeek * 7;
                    const currentId = gridDayStart + idx;
                    c.classList.toggle('selected', currentId === dayIndex);
                });
                this.el.detail.classList.remove('hidden');
                this.el.detail.classList.remove('mode-view', 'mode-edit');
                this.el.detail.classList.add(this.state.isEditMode ? 'mode-edit' : 'mode-view');
                this.renderDetail(dayIndex);
                this.loadEditForm(dayIndex);
            }
            renderDetail(dayIndex) {
                const d = this.data.plan[dayIndex];
                const baseDate = new Date(this.data.startDate);
                baseDate.setDate(baseDate.getDate() + dayIndex);
                const dateStr = `${baseDate.getFullYear()}/${baseDate.getMonth() + 1}/${baseDate.getDate()}`;
                document.getElementById('detailDate').textContent = `${dateStr} (Day ${dayIndex + 1})`;
                document.getElementById('viewTitle').textContent = d.title;
                document.getElementById('viewPurpose').textContent = d.purpose;
                document.getElementById('viewMenu').textContent = d.menu;
                document.getElementById('viewRpe').textContent = d.rpe;
                // Pace: show manual + auto lines
                const auto = this.buildAutoPaceText(d);
                const paceText = auto ? `${d.pace || ''}\n\nã€è‡ªå‹•æ›ç®—ã€‘\n${auto}` : (d.pace || '');
                document.getElementById('viewPace').textContent = paceText;
                document.getElementById('viewPoints').textContent = d.points;
                document.getElementById('viewStrength').textContent = d.strength;
                document.getElementById('viewCaution').textContent = d.caution;
                document.getElementById('viewTags').innerHTML = d.tags.map(t => `<span class="tag">${t}</span>`).join(' ');
            }
            loadEditForm(dayIndex) {
                const d = this.data.plan[dayIndex];
                document.getElementById('editTitle').value = d.title || '';
                document.getElementById('editPurpose').value = d.purpose || '';
                document.getElementById('editMenu').value = d.menu || '';
                document.getElementById('editRpe').value = d.rpe || 5;
                document.getElementById('editPace').value = d.pace || '';
                document.getElementById('editPoints').value = d.points || '';
                document.getElementById('editStrength').value = d.strength || '';
                document.getElementById('editCaution').value = d.caution || '';
                const checkboxes = document.querySelectorAll('input[name="editTags"]');
                checkboxes.forEach(cb => {
                    cb.checked = (d.tags || []).includes(cb.value);
                });
            }
            saveCurrentDay() {
                if (this.state.selectedDayId === null) return;
                const id = this.state.selectedDayId;
                const tags = [];
                document.querySelectorAll('input[name="editTags"]:checked').forEach(cb => tags.push(cb.value));
                const updated = {
                    ...this.data.plan[id],
                    dayId: id,
                    title: document.getElementById('editTitle').value,
                    purpose: document.getElementById('editPurpose').value,
                    menu: document.getElementById('editMenu').value,
                    points: document.getElementById('editPoints').value,
                    rpe: Number(document.getElementById('editRpe').value),
                    pace: document.getElementById('editPace').value,
                    strength: document.getElementById('editStrength').value,
                    caution: document.getElementById('editCaution').value,
                    tags
                };
                // Keep paceCalc as-is unless user edits JSON via export/import
                this.data.plan[id] = updated;
                this.saveToStorage();
                this.renderGrid();
                this.renderDetail(id);
                alert('ä¿å­˜ã—ã¾ã—ãŸ');
            }
            showExportModal() {
                this.el.modal.classList.add('show');
                this.el.ioText.value = JSON.stringify(this.data, null, 2);
            }
            copyToClipboard() {
                this.el.ioText.select();
                document.execCommand('copy');
                alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }
            importFromTextarea() {
                try {
                    const json = this.el.ioText.value;
                    const parsed = JSON.parse(json);
                    if (!parsed.plan || !Array.isArray(parsed.plan)) throw new Error('Invalid format');
                    if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ')) {
                        this.data = parsed;
                        if (!this.data.targets) this.data.targets = { t1500: '', t800: '' };
                        this.saveToStorage();
                        this.el.startDate.value = this.data.startDate;
                        if (this.el.t1500) this.el.t1500.value = this.data.targets.t1500 || '';
                        if (this.el.t800) this.el.t800.value = this.data.targets.t800 || '';
                        this.renderGrid();
                        this.el.modal.classList.remove('show');
                        alert('èª­ã¿è¾¼ã¿å®Œäº†');
                    }
                } catch (e) {
                    alert('JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            }
        }
        // Start
        const app = new App();
    </script>
</body>
</html>